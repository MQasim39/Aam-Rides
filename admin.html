<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aam Admin - Drivers & Rides</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f4f4f9; }
        .sidebar { height: 100vh; background: #1A1A1A; color: white; padding: 20px; position: fixed; width: 250px; }
        .content { margin-left: 250px; padding: 40px; }
        .logo { color: #FF8C00; font-weight: bold; font-size: 24px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <span class="logo">ðŸ¥­ Aam Admin</span>
        <hr>
        <div class="nav flex-column">
            <a href="#" class="nav-link text-white">Rides (Live)</a>
            <a href="#drivers" class="nav-link text-secondary">Driver Approvals</a>
        </div>
    </div>

    <div class="content">
        <h3>Pending Driver Applications</h3>
        <div id="driver-container" class="row mt-4"></div>
        
        <h3 class="mt-5">Live Rides</h3>
        <div id="rides-container" class="mt-3"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
  apiKey: "AIzaSyCldTSVZmWCiD63OhvtfTpoKNyqLi07n8k",
  authDomain: "amy-3112011.firebaseapp.com",
  projectId: "amy-3112011",
  storageBucket: "amy-3112011.firebasestorage.app",
  messagingSenderId: "359444234132",
  appId: "1:359444234132:web:bf288efa3982fd1a0a1981",
  measurementId: "G-17J7ZC26D4"
};
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 1. DRIVERS LISTENER
        const qDrivers = query(collection(db, "drivers"), where("status", "==", "pending"));
        onSnapshot(qDrivers, (snap) => {
            const container = document.getElementById('driver-container');
            container.innerHTML = '';
            snap.forEach(d => {
                const data = d.data();
                container.innerHTML += `
                    <div class="col-md-6">
                        <div class="card p-3 mb-3">
                            <h5>${data.name} <span class="badge bg-warning text-dark">${data.category.name}</span></h5>
                            <p>Vehicle: ${data.vehicleType} | Plate: ${data.plate}</p>
                            <p>AC: ${data.hasAc ? 'Yes' : 'No'}</p>
                            <button onclick="approveDriver('${d.id}')" class="btn btn-success btn-sm">Approve Application</button>
                        </div>
                    </div>
                `;
            });
        });

        // 2. APPROVE FUNCTION
        window.approveDriver = async (id) => {
            await updateDoc(doc(db, "drivers", id), { status: 'approved' });
            alert("Driver Approved! Email notification simulated.");
        };
    </script>
</body>
</html>